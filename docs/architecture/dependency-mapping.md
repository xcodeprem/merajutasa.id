# Dependency Mapping

This document describes the component dependency mapping system used to derive startup order and operational guidance.

## Artifacts

- **Machine-readable:** build/deps/graph.json (CI artifact)
- **Diagram source:** docs/architecture/dependency-graph.mmd

## How to Update

1. Edit config/component-registry.json
2. Run `npm run deps:graph`
3. Commit changes to .mmd (do not commit PNG/SVG)

## Policy

- No new circular dependencies (maxCycles: 0)
- Changes to registry require review from Architecture WG

## Component Registry Format

The component registry (`config/component-registry.json`) uses a simple format:

```json
{
  "version": "1.0.0",
  "description": "Component registry description",
  "components": [
    {
      "id": "service-name",
      "name": "Human Readable Name",
      "type": "service|database|cache",
      "category": "core|infrastructure|utility", 
      "dependsOn": ["dependency1", "dependency2"],
      "healthEndpoint": "/service/health",
      "description": "Service description"
    }
  ]
}
```

Where:

- `id`: Unique identifier for the component
- `dependsOn`: Array of component IDs this service depends on (can be empty)
- `dependencies`: Legacy field name (also supported for backward compatibility)

**Field Compatibility:** The dependency checker supports both `dependsOn` (preferred) and `dependencies` (legacy) field names for maximum compatibility.

## Generated Artifacts

### build/deps/graph.json

Machine-readable dependency graph containing:

- `nodes`: Array of all component names
- `edges`: Array of dependency relationships with `from` and `to` properties

### docs/architecture/dependency-graph.mmd

Mermaid diagram source showing the dependency relationships. This file is automatically generated and should not be manually edited.

## Validation

The dependency mapping system enforces:

- All dependencies must exist in the registry
- No circular dependencies allowed (maxCycles: 0)
- Topological sorting must be possible

## Integration

The dependency mapping feeds into:

- **Startup order documentation** (docs/operations/startup-order.md)
- **Health check systems** (tools/integrated-health-check.js)
- **Component validation** (tools/component-dependency-check.js)
